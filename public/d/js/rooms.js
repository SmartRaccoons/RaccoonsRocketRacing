// Generated by CoffeeScript 1.6.3
(function() {
  var CreateRoom, Room, Rooms, _ref, _ref1, _ref2,
    __hasProp = {}.hasOwnProperty,
    __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

  App.Rooms = Rooms = (function(_super) {
    __extends(Rooms, _super);

    function Rooms() {
      _ref = Rooms.__super__.constructor.apply(this, arguments);
      return _ref;
    }

    Rooms.prototype.tagName = 'ol';

    Rooms.prototype.rooms = {};

    Rooms.prototype.room_add = function(data) {
      var r,
        _this = this;
      r = new Room();
      r.rooms = this;
      this.listenTo(r, 'join', function() {
        return _this.trigger('join', data.id);
      });
      this.listenTo(r, 'monitor:add', function() {
        return _this.trigger('monitor:add');
      });
      this.listenTo(r, 'monitor:remove', function() {
        return _this.trigger('monitor:remove');
      });
      r.render(data);
      r.$el.prependTo(this.$el);
      return this.rooms[data.id] = r;
    };

    Rooms.prototype.room_remove = function(data) {
      this.rooms[data.id].remove();
      return delete this.rooms[data.id];
    };

    Rooms.prototype.user_join = function(data) {
      return this.rooms[data.room_id].user_add(data.user);
    };

    Rooms.prototype.user_left = function(data) {
      return this.rooms[data.room_id].user_left(data.user_id);
    };

    Rooms.prototype.list = function(rooms) {
      return this.render(rooms);
    };

    Rooms.prototype.render = function(rooms) {
      var _this = this;
      _.each(this.rooms, function(r, i) {
        return _this.room_remove({
          'id': i
        });
      });
      return _.each(rooms, _.bind(this.room_add, this));
    };

    return Rooms;

  })(Backbone.View);

  Room = (function(_super) {
    __extends(Room, _super);

    function Room() {
      _ref1 = Room.__super__.constructor.apply(this, arguments);
      return _ref1;
    }

    Room.prototype.tagName = 'li';

    Room.prototype.template = _.template("<ul></ul>\n<button type='button'><%=_l('Play')%></button>");

    Room.prototype.events = {
      'click button': function() {
        return this.trigger('join');
      }
    };

    Room.prototype.user_add = function(user) {
      this._users += 1;
      if (this._users === this._max) {
        this.$button.attr('disabled', '');
      }
      if (user.id === this.rooms.options.monitor) {
        this.trigger('monitor:add');
        this._monitor = true;
      }
      return this.$ul.append('<li data-pk="' + user.id + '"><strong>' + user.name + '</strong></li>');
    };

    Room.prototype.user_left = function(user) {
      this._users -= 1;
      if (this._users < this._max) {
        this.$button.removeAttr('disabled');
      }
      if (user === this.rooms.options.monitor) {
        this._monitor = false;
        this.trigger('monitor:remove');
      }
      return this.$ul.find('li[data-pk="' + user + '"]').remove();
    };

    Room.prototype.render = function(data) {
      Room.__super__.render.apply(this, arguments);
      this._users = 0;
      this._max = data.max;
      this.$ul = this.$('ul');
      this.$button = this.$('button');
      this.$el.attr('data-pk', data.id);
      return _.each(data.users, _.bind(this.user_add, this));
    };

    Room.prototype.remove = function() {
      if (this._monitor) {
        this.trigger('monitor:remove');
      }
      return Room.__super__.remove.apply(this, arguments);
    };

    return Room;

  })(Backbone.View);

  App.CreateRoom = CreateRoom = (function(_super) {
    __extends(CreateRoom, _super);

    function CreateRoom() {
      _ref2 = CreateRoom.__super__.constructor.apply(this, arguments);
      return _ref2;
    }

    CreateRoom.prototype.className = 'room-new-add';

    CreateRoom.prototype.template = _.template("<button><%=_l('Create room')%></button>");

    CreateRoom.prototype.events = {
      'click button': function() {
        return this.trigger('create');
      }
    };

    return CreateRoom;

  })(Backbone.View);

}).call(this);
